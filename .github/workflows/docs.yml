name: docs

on:
  push:
    branches: [master]
    paths:
      - 'lua/**/*.lua'
      - '.github/workflows/docs.yml'

jobs:
  docs:
    runs-on: ubuntu-latest
    name: Generate vimdoc
    steps:
      - uses: actions/checkout@v4

      - name: Download lemmy-help
        run: |
          curl -Lq https://github.com/numToStr/lemmy-help/releases/latest/download/lemmy-help-x86_64-unknown-linux-gnu.tar.gz | tar xz
          chmod +x lemmy-help

      - name: Generate vimdoc
        run: |
          ./lemmy-help -c \
            lua/search-replace/init.lua \
            lua/search-replace/config.lua \
            lua/search-replace/core.lua \
            > doc/search-replace.txt

      - name: Commit changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "docs: auto-generate vimdoc"
          file_pattern: doc/*.txt
